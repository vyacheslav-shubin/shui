Расширения G-кода прошивки SHUI

M109, M190 опции 
    M - mute выключает периодический вывод в консоль сообщений о состоянии нагревателей
    U - unstable - температура считается достигнутой сразу при превышении целевой

M414 - переопределенная стандартная комманда выбора языка интрерфейса
  	    параметр S - определяет язык.
	    0 - en, 1 - ru, 2 - ua, 3 - nl
    M114 S1 ; Выбор русского языка

M302 - Cold Extrude перекрыта реализация с целью сохранения настроей температуры.

M81 дополнительные параметры:
        С - взять параметры из настроек модуля управления питанием
        D (delay) задержка выключения [0..255] секунд
        T (temperature) - ожидание охлаждения хотэнда
        F (fan) - включение вентилятора при ожидании охлаждения
    M81; выключение незамедлительно
    M81 D100; выключение через 100 секунд
    M81 D100 T60; выключение не менее чем через 100 секунд, и при охлаждении до 60 градусов
    M81 D100 T60 F; Дополнтительно включить вентилятор

G61 получила краткую форму (обновление отправлено в дистрибутив Marlin)
        Если не указывать параметры, то сначала восстанавливаются координаты XY, затем ZE

M851 добавлена в backup
        добавлены параметры
        С - clearance, L - z probe low point, N - number of failed probes
        B - bltouch (0/1) I - inaccuracy

M117.1 - вывод типовых сообщений
    P - текущая позиция
    T - температура сопла и стола
    L - текущий слой и всего слоев (если в g коде этих данных нет, в сообщении отразиться 0/0)
    D (duration) продолжительность печати
    F - Филамент
    M117.1PT выведет два сообщения

M2000 - задание размера области рабочей области (стол, высота)
M2000.0 - минимальные значения
M2000.1 - максимальные значения
    M2000.0 X0 Y0 Z0        ;min axis values
    M2000.1 X225 Y225 Z240  ;max axis values
    T - тип устройства 0 - принтер, 1 - лазер, 2 - фрезер
    E(0|1) - использование программных концевиков

M2001 - задание инверсии и кинетатики моторов, параметр T определяет для какого экструдера указыватся параметр E
    M2001 X1 Y1 Z1 T0 E1    ;Stepper inversion (1 - inverted)
    M2001 T1 E1	; Stepper inversion, extruder 1
    ;С - кинематика
        0-xyz, 1 - core, 2 - markforged, 3 - markforged m
    ;I inactive timeout - время в секундах, по истечении которого моторы переходят в отключенное состояние, если не использовались
        0 - не отключать моторы

M2002 - Настройки концевиков
    ;X, Y, Z, E - оси, P - probe (сенсор уровня стола)
    ;I - импульсный сенсор окончания филамента (флаг)
    ;Sensors passive level (1 - vcc / 0 - gnd)
    M2002 T0 E1
    M2002 T1 E1
    M2002 X1 Y1 Z1 P0
M2002.1 - Настройки позиции концевиков
    ;X, Y, Z
    ;Sensors position (0 - min, 1 - max)
M2002.2 - Прочее
    Контроль срабатывания концевиков (hit test)
    H0 - выключен, H1-включен
    R - ranout для сенсора движения филамента (длина перемещения пластика, за которую сенсор должен гарантированно сменить состояние)

M2003 - настройка алгоритмов уровня стола
        B - border  - растояние до края стола при измерении. Для BlTouch будет учено его смещение относительно сопла
        P - номер точки сетки стола
        Z - кривизна стола в точке P
        S - размер сегмента
        A - алгоритм (1, 4, 5, 9, 13)
        Q - рамер стороны квадрата при замере по центру
        T - Порог (минимальное отклонение любого значения от 0 и разности между минимальным и максимальным значением сетки)
        L - минимальный размер сетки

        P - номер точки Z - высота сетки


    M2003 B20 M1; измерения проводятся в 20 мм открая, после парковки будет включаться карта высот

M2004, M2004.0 - настрока модуля питания
        Изменено F - флаги, битовая маска, может быть суммой следующих значений.
        Изменено 1 - Модуль присутсвует,
        Изменено 2 - Автоматические выключение по окончании печати
        Изменено 4 - Ожидание охлаждения хотэнда
        Изменено 8 - Включить вентилятор при ожидании охлаждения
        Изменено 16 - PWC
        Изменено 32 - Реверс PA2

	    S - Ожидание перед выключением (0-255 секунд)
	    T - Температура до которой должен отсыть хотэнд, перед выключением принтера (0-255 celsius)
    M2004 F15 S120 T60

M2004.1 - настрока автоотключения
    D - Дисплей (сек)
    H - Нагреватели (мин)
    P - Общее питание (мин)

M2005 - Управление сниппетами
    	E - стереть сниппеты
        S - задание номера сниппета
        | после номера и далее - код сниппета
        Сниппеты могут быть стерты из памяти только все сразу.
        Назначение каждого сниппета возможно только один раз после стирания.
        Поэтому, для переназначения сниппета необходимо удалить и записать все текущие используемые.
        Тем не менее, если ранее сниппет с нужным номером не был записан, его можно задать отдельно.
    M2005 E ;Erase snippets
    M2005 S0|G91|G1 X%3.1f F2000|G90        ;MOVE_X_INC 0
    M2005 S1|G91|G1 X-%3.1f F1000|G90       ;MOVE_X_DEC 1

M2006 - вызов виджета
        W - номер виджета (старый вариант)
        N - номер виджета (новый вариант)
                NONE = 0,
                POWER_OFF,
                FILAMENT,
                FAN,
                HEATING,
                HOME, //5
                LEVELING,
                MOVE,
                MOVE_PANE,
                CONSOLE,
                YANDEX, //10
                DEBUG,
                YOGURT,
                TEMPERATURE_STAT, //13
        С - закрыть виджет
    M2006 N2 - отобразить виджет смены филамента
        Включая виджет на отображение предыдущий виджет попадает в стек, поэтому вызов
  	M2006 С - приведет к отображению ранее активного виджета.
        Размер стека виджетов ограничен 5!
        Особые номера:
    M2006 N0 - стартовый виджет (стек виждетов будет обнулен)
	M2006 N-1 - возврат по стеку, аналогичен  M2006 С

M2007 - флаги состояния (для отладки)

M2008 - Задание точки смены филамента
        X, Y - абсолютная координата, Z - относительная.
	    E - втягивание пластика перед сменой
	M2008 X20 Y20 Z20 E5

M2009 - задание параметров модуля WIFI
        M - (mode) тип модуля 1 - станция, 2 - точка доступа, 0 - отключен
        T - смещение времени NTP
        R - reset сброс модуля
M2009.1 - для модуля в режиме станции
M2009.2 - для модуля в режиме точки доступа
        S - SSID
        P - пароль
M2009.3 - задание параметров telegram бота
        С - чат ID
        //S - статус сообщения (0/1) не реализовано, используется M2014 флаг 17
        //E - сообщения об ошибоках (0/1) не реализовано, используется M2014 флаг 18
    M2009.3 С:-1001197511741 K:539370000:AAAAAAAAAAAAAAAA-GVIkoVEFKPjOZsrKUs


M2009.4 - задание ключа OAuth сервисов  yandex
    K - ключ доступа
    M2009.4 K:***************************************
    ;запрос ключа доступа
    ;https://oauth.yandex.ru/authorize?response_type=token&client_id=aa7495d659324bba959517fff3306c7d
    https://oauth.yandex.ru/authorize?response_type=token&client_id=149ab5fe35d0452fadf55d8800b3655f&redirect_url=https://oauth.yandex.ru/verification_code

    M2009.1 S:HOME_NETWORK P:pleaseplease
    M2009.2 S:SHUI P:pleaseplease
    M2009 M1 T180

	;Вариат конфигурирования модуля с "шифрованием" пароля
	M2009.1 CH:B2B16F79D0D4D155A8B7230151D7043B23FBE8DFB8081F0EC72C61
	M2009.2 CH:D2EFDD5DEDFBBDE6686A5D862B15E5CA2A3730102405

M2009.5 - определение набора выводимых в телеграмм сообщений
    H - HOMING
    S - STATUS M117
    P - PID
    R - MS_PRINTING
    M - MARLIN статус-сообщения выставляемые marlin
    L - LEVELING
    T - HEATING
    Y - LAYER TRIGGER
    D - MODEL TYPE
    E - ERRORS

M2009.6 - Телеметрия
    T - интервал в секундах. 0, 10-255. 0 - отключено.



M2010 - резервировать настройки
        имеет 4 параметра P, A, M - (pid, all, mesh)
	    U (ui) 0/1 отображает дилог завершения
    M2010 ;резервировать настройки (будет создан файл на флешке CFGBKP.GCO)
	M2010 P; резервировать настройки PID (будет создан файл на флешке @PID.GCO)
	M2010 M; резервировать настройки карты высот стола (будет создан файл на флешке @MESH.GCO)
	M2010 A P; резервировать настройки PID, и все настройки.
	M2010 R - создание RECOVER файла

M2010.1 - подготовить данные для файла восстановления
M2010.2 - Загрузить Preview и данные о модели

M2011 - вывод диалогового окна с сообщением
        S - время отображения в секундах
        или P - время отображения в миллисекундах
        если ни S ни P не заданы, то отображать до нажатия.
	    В отличии от M0 и M1 M2011 не останавливает выполнение дальнейшего кода

    M
	    см. так же M2006 C
        В Марлин есть подобная команда M117, выводящая текст в статусную строку

M2012 - Выполнить сниппет
        S-номер сниппета
    M2012 S21

M2013 - дополнительные конфигурирования парковки
        X, Y, Z - clearance
        C - Z по цетру (0/1)
        P - probe (0/1) использовать сенсор стола для парковки
M2013.1 - повторная парковка. Бампинг
        X, Y, Z - откат
        S - множитель скорости Vertical feed rate/Horizontal feed rate
M2013.2 - Смещение концевиков
        X, Y, Z - смещение
        U - Z2
M2013.3 - Смещение концевиков
        X, Y точка замера Z
        Z - зазор Z пеоред парковкой XY


M2014, M2014.0  - установка, сброс флагов
        F - flag - номер флага
        S - set (0/1) - включено/выключено
    Флаги:
        1 - Ноль на калькуляторе
        2 - Логгирование
        3 - Короткие имена файлов
        4 - Управление концевиками
        6 - Сброс частных настроек после печати
        7 - Наличие второго экструдера
        8 - Robin nano 1.1
        9 - Вентилятор вместо второго хотэнда (флаг 7 должен быть сброшен)
        10 - Всегда запускать печать при получении файла по сети
        11 - Поддержка esp32
        12 - Сообщения в Telegram (общий флаг), включене-выключение telegramm
        13 - Инспектор файлов, показать скрытые
        14 - Инспектор файлов, показать только G-код
        15 - Переворот дисплея на 180 градусов
        16 - Два мотора по оси Z (флаг 7 должен быть сброшен)
        17 - Циклоп (флаг 7 должен быть установлен, 16 сброшен)
        18 - ----
        19 - E1<=>E2 назначить набор портов E1 для E2 и наоборот

        20 - Стол передвигается по Z или Y
        21 - Двунаправленная кнопка выбора пресетов
        22 - beeper
        23 - Отборазить значение сенсора температуры T2 в статусной строке
        24 - Расширенный стартовый виджет
        25 - Температуры на стартовом виджете
        26 - Диалоговая кнопка пресетов
        27 - Trinamic detector
        28 - Игнорировать ошибку bltouch
        29 - *AdS
        30 - Датчик тока
        31 - Низкая частота sd
        32 - Soft PWM Fan
        33 - Z триггер по номеру слоя
        34 - S-curve
        35 - Async Z2
        36 - Swap Z1 Z2
        37 - Use lock
        38 - Lin advance
        39 - Touch feedback
        40 - Управление холодным филаментом
        41 - ЧБ
        42 - Первичный носитель
        43 - G28->G28+G29 умолчание
        44 - Блокировка незапаркованных осей
        45 - M412S defalut
        46 - gcode motion mode
        47 - For small moves with >135° junction (octagon) find speed for approximate arc
        48 - Skew enable/disable
        49 - Инверсия Z2 от Z1

        50 - автовыключение
        51 - ожидание охладжения
        52 - использование вентилятора
        53 - активный уровень удержания
        54 - watchdog

        60 - Classic Jark on/off
        61 - Junction deviation on/off

        62 - Уровень сигнала включения подсветки 1
        63 - Уровень сигнала включения подсветки 2
        64 - Уровень сигнала включения подсветки 3

        65 - backlash on/off
        66 - Размер сетки по модели
        67 - Оптимизация замера сетки

        68 - Input shaping ON/OFF
        69 - Стиль отрисовки кривизны стола (светлый, темный)
        70 - Стиль отрисовки кривизны стола (нормализация)
        71 - Единицы отображения скорости подачи мм/сек или мм/мин
        72 - Толстые пальцы (у меня лапки)
        73 - Trimamic runtime_control
        74 - Ввод координат. Установка/перемещение
        75 - Wifi Telegram raw message/Сервер телеметрии
        76 - Автоматическая корректировка babystepping

        77 - FWBL PB2 Lock
        78 - FWBL beep
        79 - FWBL log

        81 - Горизонт по сенсору стола
        82 - Расположение винтов Z 0-LR, 1-FB
        83 - Инверсия X2 от X1
        84 - Инверсия Y2 от Y1


M2014.1 - Вещественные величины
        I - index - номер
        V - value - значение

        1 - Ручное управление, подача XY
        2 - Ручное управление, подача Z
        3 - Ручное управление, подача E
        4 - Загрузка, выгрузка филамента подача
        5 - Скорость парковки XY
        6 - Скорость парковки Z
        7 - Замер стола, склость перемещения XY
        8 - Замер стола, склость перемещения  Z

        10, 11, 12, 13 - дискреты перемещения

M2014.2 - Целые величины
        I - index - номер
        V - value - значение

        1 - Интервал контроля состояния драйверов trinamic (сек)
        2 - Расстояние между винтами оси Z
        3 - Максимальный перекос горизонта стола (мм)



M2015, M2015.0 - сообщения телеграмм
M2015.1 - выполнение сценария Yandex Alisa

M2016 - Настройки нагревателя
    M2016 P1 H2 D5000 W1 R1
        P - 1-PID, 0 - BANG-BANG
        H - гистерезис (градусы)
        D - дискретизация (миллисекунды)
        Y - 0/1 dYmanic PID
        E - номер нагревателя (0, 1, -1) (по умолчанию -1 - стол(совместимость))
        L - предел нагрева
        S - сенсор
            0 - 	// Marlin #1, R25 = 100 kOhm, beta25 = 4092 K, 4.7 kOhm pull-up, bed thermistor
            1 - 	// Marlin #1047, Pt1000 with 4k7 pullup
            2 -	// Marlin #5, R25 = 100 kOhm, beta25 = 4267 K, 4.7 kOhm pull-up
                // 100k ParCan thermistor (104GT-2)
            3 - 	// Marlin #9, R25 = 100 kOhm, beta25 = 3960 K, 4.7 kOhm pull-up, GE Sensing AL03006-58.2K-97-G1

        C - Точка пересечения кривых температур
        T - Масштабный коэффициент (0.5-2)
        U - выбор формуты
            0: To=(Ti-C)*T+C
            1: To=Ti*T+C

        W - watch -  Контроль нагревателя стола, обязательное положительное изменение температуры при нагреве
        I - Min Increase/60s минимальная скрость нагрева (при недостижении уход в ошибку)
        R - runaway - Контроль нагревателя стола, runaway уход температуры вниз
        N - время (секунды, время выхода из состояния провала температуры)
        O - Overheat - контроль перегрева
        A - Контроль сенсора (обрыв, замыкание)

        Y - 0/1 dYmanic PID
        F - Fast Heat
        B - Время ожидание стабилизации в секундах

M2016.1 - Настройка алгоритма калибровки PID
    O - overshoot - предел перегрева, уход в ошибку
    C - cycle time - максимальное время цикла. При превышении однократный перезапуск цикла, при повторном срабатывании уход в ошибку

{ "palette": {
    "system-display": {"bg": "0x000080", "fg": "0xFFFFFF"},
    "main": { "bg": "0x181818", "fg": "0xFFFFFF" },
    "progress": { "bg": "0x00FF00", "fg": "0x000000" },
    "terminal": { "bg": "0x000000", "fg": "0x00FF00" },
    "config-line" : "0x00FF00",
    "dialog-frame" : "0x303CCB"
}}

M2017 - Переопределение UI
    K - lock key

    L - цвет config-line (в конфигурацию не сохраняется)
    D - цвет dialog-frame (в конфигурацию не сохраняется)
    N - номер кнопки
    W - вызываемый виджет
        0 - не отображается
        1 - выключение питания (если модуль установнен),
        2 - упрвление филаментом,
        3 - упрвление вентиляторами,
        4 - упрвление нагревателями,
        5 - парковка,
        6 - уровни,
        7 - перемещение,
        8 - консоль g кода
        9 - ядекс диск (если модуль esp32 установнен)
    S - Виджет (кнопка) состяний
        0 - не отображается,
        1 - время печати,
        2 - текущаяя координата X
        3 - текущаяя координата Y,
        4 - текущаяя координата Z,
        5 - номер текущего слоя, число слоев, триггер паузы печати по высоте,
        6 - температрура сопла 1
        7 - температрура сопла 2
        8 - температрура стола
        9 - длина использованного филамента
        10 - текущая скорость
        11 - состояние вентилятора
        12 - смещение сенсора стола по Z


Парные цвета (в конфигурацию не сохраняется)
    B-background color
    F-foreground color
M2017.1 - основной цвет фона и текста
M2017.2 - цвет фона и текста окна с системной ошибкой
M2017.3 - прогресс бар
M2017.4 - warning прогресс бар
M2017.5 - Окно терминала

M2018 - Йогурт таймер
        H - часы
        M - минуты
        S - секунды
        A -
            0-стоп/сброс,
            1-старт (если задано время)/продожение(если HMS не указаны),
            2-пауза,
            3-цикличный старт
        P - 0/1 стоп таймера по окончании исполнения печатаемого файла
        R - run исполнение макроса:
            подробнее (https://marlinfw.org/docs/gcode/M810-M819.html)
            включено первые 5 слотов. Использовать можно 810-814

M2020 - настройка вентиляторов
    -Частота SoftPWM вентилятора (в настоящий момент только вентилятора охлаждения модели)
        W - Частота SoftPWM * 2^w, чем выше частота, тем больше шаг изменения скорости вентилятора и тем меньше этих шагов.
             SoftPWM имеет 128 значений, что соответсвует W=0. При W=1 значений 64, W=2 - 32, W=3 - 16, W=4 - 8, W=5 - 4
        K - kickstart ms
M2020.1 - Медвежий вентилятор
        S - номер медвежьего вентилятора (0, 1)
        H - если активен любой нагреватель
        A - температура контроля по сенсору H1
        B - температура контроля по сенсору H2

M2022 - M3/M5 mode
    M 0 - выключено, 1 - zHop, 2 - pe5
    Z - величина zHop

M2023 - Настройка датчика тока
    Z - точка ноля - значение с ADC
    K - коэффициент приведения. Функция CUR(DAC) низходящаяя и линейная, поэтому C=-(DACv-Z)*K/1000


M2024 - Настройка сенсора экрана
    LTRB - min/max значения координат, полученных с сенсора диспленя
    L - left (x min)
    R - right (x max)
    T - top (y min)
    B - bottom (y max)
    С - long click - длительность долгого нажания мс

M2025 - Мапинг портов
    F - функциональность
    P - порт


M2030 - Настройки управления филаментом
    F - default flow (проценты)
    L - load/unoad feed rate
    S - single step feed rate
    D - диаметр филамента по-умолчанию

M2031 - Открыть внешний диск:
    [Y|T|O]:KEY
    Y - yandex
    0 - other
    //Yandex SHUI Firmware
    M2031 Y:https://disk.yandex.ru/d/AXI7sKW73vzvLA
    //GIT SHUI-3d models
    M2031 O:67F4192E-3E0D-48BF-AE1F-BFAB0461F5E9
    //Телеграм - shui-public
    M2031 O:-1001197511741

M2031.1 - только установить ключ сессии

M2031.2 - загрузить файл (экспериментально)
    F: - номер файла (0 - по умолчанию)
    D: - каталог

    M2031.2 F:0 D:/test-only/RN12

M2032 Загрузка с облачных дисков

M2033 Управление внешними устройствами
    M2033.1 MAX7219
        R - регистр
        V - значение регистра
        T - тест

M2033 информационные сообщения для внутренних алгоритмов прошивки
M2033.1 - прогресс печати и параметры слайсера
    L - номер текущего слоя
    W - ширина выдавливаемой линии
    XYZ - ось по которой дана информация
        I - минимум A - максимум
    F - филамент
    T - время
    H - толщина слоя
    C - число слоев
M2033.2 [строка] - тип печатаемой части модели (внешняя, внутренняя стенка, заполнение..)

M2034 Настройка лазера
    F - частота
    P - мощность режима фокусировки
    E - модуль используется
    T - трапецоид
    С - G0 CS=OFF
    W - G0 PWM=OFF
    L - уровень включения

M2035 - Actions
    Действия и их настройки, назначаемые на триггеры
        I - Номер действия (0-9)
        A - Тип действия
            0 - Бездействие
            1 - Прерывание операций
            2 - Управление освещением
        R - Сброс состояния (наличие флага в g коде)
        E - отсутствие флага - действие выключено, присутствие - включено
        O - отсутствие флага - возможно повторное срабатывание, присутствие - одноразовое (на основе гистерезиса триггера)
    Опции зависящие от типа действия
        1 - Прерывание операций
            Наличие флага определяет выполнение действия
            T - прерывание печати
            H - выключение нагревателей
            M - завершение блокировки команды M0, M1
            S - выключение питания
            B - включение бипера
        2 - Управление освещением
            S - наличие флага - включение, отсутствие - выключение
            L(N) - N - номер лампы 0, 1, 2, 3(RGB)
            R - значения для RGB ленты
            G
            B 
        3 - Бипер
            S - наличие флага - включение, отсутствие - выключение
            P - длительность в мс
M2035.1 - тестирование действий
        I - Номер действия (0-9)

Пример 1:
M2035.1 I0; выполнить действие 0


Пример 2:
M190 S80 ;Ожидаем нагрева стола
M2035 I0 E A2 S L0      ;Действие 0, включено, управление освещением, включает лампу 0
M2035 I1 E A2 L0        ;Действие 1, включено, управление освещением, выключает лампу 0
M2036 I0 H0 L1          ;Для триггера температуры стола установлены действия выключение - действие 0, включение - действие 1
M2036.1 I0 E A L78 H82    ;Собственные настройки триггера температуры стола. Триггер активен. Порог выключения - 78 градусов, порог включения 82




M2036 - Triggers
    M2036 или M2036.0 - установка действий для триггера
        E - 0 - триггер выключен, 1 - включен
        I - Номер триггера
            0 - триггер температуры стола
        L - Индекс действия при переходе триггера в выключенное состояние
        H - Индекс действия при переходе триггера во выключенное состояние
    M2036.1 - Установка собственных параметров триггера, перечень зависит от типа триггера
        I - Номер триггера
            0 - триггер температуры стола
            1 - нагреватель сопла 1
            2 - нагреватель сопла 2
        I[0..2]:
            L - Нижняя граница температуры, переход за которую вниз приведет к выключению триггера
            H - Верхняя граница температуры, переход за которую вверх приведет к срабатыванию триггера
            A - абсолютные величины L и H, в противном случае относительные. 
                Определение петли гистерезиса:
                [Целевая температура-L - Целевая температура+H]
                или 
                [L - H]




M303 - расширение. Калибровка PID по таблице
    При наличии B или H определяются следующие параметры:
        S - слот (0-4) если слот не указан, замеры производятся для всех слотов в последовательности возрастания температур
            если температура задана 0 - слот пропускается
        С - Число повторений (больше 2)
        B - стол
        H - hotend

M301, M304 - расширение, загрузка таблиц динамического PID
    Добавлен параметр S - номер слота и T температура
        M301 S0 T190 P22.200 I1.080 D114.000
        M301 S1 T200 P22.200 I1.080 D114.000
        M301 S2 T220 P22.200 I1.080 D114.000
        M301 S3 T240 P22.200 I1.080 D114.000
        M304 S0 T60 P10.000 I0.023 D305.400
        M304 S1 T70 P10.000 I0.023 D305.400
        M304 S2 T90 P10.000 I0.023 D305.400
        M304 S3 T100 P10.000 I0.023 D305.400

M2097 - Перейти на маркер новой модели
M2098 - Маркер новой модели
M2099 - Для отладки


